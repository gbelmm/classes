<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Important Survey</title>
  
  
  <style>

      body {
        font-family: sans-serif;
        font-family: Helvetica;
        margin:50px;
      };

  </style>



  <!-- Code to configure Keen IO -->

  <script type="text/javascript" src="https://keen_web_static.s3.amazonaws.com/code/keen-1.1.0.js"></script>
   
  <!-- Google JS library -->
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    
  <!-- Google library loader --> 
  <script type="text/javascript">
      google.load("jquery", "1.4.2");
  </script>
  
  <script>
  // <!-- Keen IO Client Configurations -->     
  Keen.configure("5119a923a136b071b6000000", "d03a1c87051f45c99c7ecbc38f6ebfc5");


  <!-- Code to detect browser info -->

    var BrowserDetect = {
    	init: function () {
    		this.browser = this.searchString(this.dataBrowser) || "An unknown browser";
    		this.version = this.searchVersion(navigator.userAgent)
    			|| this.searchVersion(navigator.appVersion)
    			|| "an unknown version";
    		this.OS = this.searchString(this.dataOS) || "an unknown OS";
    	},
    	searchString: function (data) {
    		for (var i=0;i<data.length;i++)	{
    			var dataString = data[i].string;
    			var dataProp = data[i].prop;
    			this.versionSearchString = data[i].versionSearch || data[i].identity;
    			if (dataString) {
    				if (dataString.indexOf(data[i].subString) != -1)
    					return data[i].identity;
    			}
    			else if (dataProp)
    				return data[i].identity;
    		}
    	},
    	searchVersion: function (dataString) {
    		var index = dataString.indexOf(this.versionSearchString);
    		if (index == -1) return;
    		return parseFloat(dataString.substring(index+this.versionSearchString.length+1));
    	},
    	dataBrowser: [
    		{
    			string: navigator.userAgent,
    			subString: "Chrome",
    			identity: "Chrome"
    		},
    		{ 	string: navigator.userAgent,
    			subString: "OmniWeb",
    			versionSearch: "OmniWeb/",
    			identity: "OmniWeb"
    		},
    		{
    			string: navigator.vendor,
    			subString: "Apple",
    			identity: "Safari",
    			versionSearch: "Version"
    		},
    		{
    			prop: window.opera,
    			identity: "Opera",
    			versionSearch: "Version"
    		},
    		{
    			string: navigator.vendor,
    			subString: "iCab",
    			identity: "iCab"
    		},
    		{
    			string: navigator.vendor,
    			subString: "KDE",
    			identity: "Konqueror"
    		},
    		{
    			string: navigator.userAgent,
    			subString: "Firefox",
    			identity: "Firefox"
    		},
    		{
    			string: navigator.vendor,
    			subString: "Camino",
    			identity: "Camino"
    		},
    		{		// for newer Netscapes (6+)
    			string: navigator.userAgent,
    			subString: "Netscape",
    			identity: "Netscape"
    		},
    		{
    			string: navigator.userAgent,
    			subString: "MSIE",
    			identity: "Explorer",
    			versionSearch: "MSIE"
    		},
    		{
    			string: navigator.userAgent,
    			subString: "Gecko",
    			identity: "Mozilla",
    			versionSearch: "rv"
    		},
    		{ 		// for older Netscapes (4-)
    			string: navigator.userAgent,
    			subString: "Mozilla",
    			identity: "Netscape",
    			versionSearch: "Mozilla"
    		}
    	],
    	dataOS : [
    		{
    			string: navigator.platform,
    			subString: "Win",
    			identity: "Windows"
    		},
    		{
    			string: navigator.platform,
    			subString: "Mac",
    			identity: "Mac"
    		},
    		{
    			   string: navigator.userAgent,
    			   subString: "iPhone",
    			   identity: "iPhone/iPod"
    	    },
    		{
    			string: navigator.platform,
    			subString: "Linux",
    			identity: "Linux"
    		}
    	]

    };
    BrowserDetect.init();


    // <!-- Code to prepare analytics data and send it to Keen IO -->

    var recordEvent = function () {
        // create an event as a JS object

        var landing = {
            page: "Exercise 2 Answers",
            browser: {
                name: BrowserDetect.browser,
                version: BrowserDetect.version,
                OS: BrowserDetect.OS
            }
        };
        
        console.log(landing);
          
        // add it to a Keen IO collection
        Keen.addEvent("pageviews", landing,
        function () {
        },
        function (e) {
                 alert('no event sent to keen');
        });
        
    };
    
    // <!-- Code to do stuff when the document is ready -->    

      $(document).ready(function(){
          recordEvent();
      });

      
    // <!-- Code to get data for Keen charts -->   
    
    Keen.onChartsReady(function(){
        //Create a Metric for the number of events in hottie_selections collection
        var hottieEvents = new Keen.Metric("hottie_selections", {
            analysisType: "count",
        });
        
        
        //Draw that Metric
        hottieEvents.draw(document.getElementById("events"), {
            label: "Total Events",
        });
        
        //Create a Metric for the number of unique users submitting hotties
        var uniqueNames = new Keen.Metric("hottie_selections", {
            analysisType: "count_unique",
            targetProperty: "name"
        });
        
        
        //Draw that Metric
        uniqueNames.draw(document.getElementById("uniqueNames"), {
            label: "Unique Names",
        });
        
        //Create a Metric for the number of hunks grouped by hunk choice
        var hottieCount = new Keen.Metric("hottie_selections", {
            analysisType: "count",
            groupBy: "hunk"
        });
        
        //Create a PieChart visualization for that Metric.
        var hottiePie = new Keen.PieChart(hottieCount, {
            height: 300,
            width: 600,
            title: "Hunk Distribution",
            minimumSlicePercentage: 1,
            colors:["#FF6699","#33CCCC","#003366","#FFCC33"]
        });
        
        //Draw the visualization into a div
        hottiePie.draw(document.getElementById("3"));
        
        //Create a Metric for the average rating for the class
        var averageRating = new Keen.Metric("class_ratings", {
            analysisType: "average",
            targetProperty: "rating.value"
        });
        
        
        //Draw that Metric
        averageRating.draw(document.getElementById("4"), {
            label: "Average Rating",
        });
        
        //Create a Metric for the average rating by users who selected Zack
        var zackAverage = new Keen.Metric("class_ratings", {
            analysisType: "average",
            targetProperty: "rating.value",
            filters: [{
                "property_name" : "user.hunk",
                "operator" : "eq",
                "property_value" : "zack"
            }]
        });
        
        //Draw that Metric
        zackAverage.draw(document.getElementById("zackavg"), {
            label: "Zack Fans Average Rating",
        });
        
        //Create a Metric for the average rating by users who selected Slater
        var slaterAverage = new Keen.Metric("class_ratings", {
            analysisType: "average",
            targetProperty: "rating.value",
            filters: [{
                "property_name" : "user.hunk",
                "operator" : "eq",
                "property_value" : "slater"
            }]
        });
        
        //Draw that Metric
        slaterAverage.draw(document.getElementById("slateravg"), {
            label: "Slater Fans Average Rating",
        });
        
        var browserGrouped = new Keen.Metric("hottie_selections", {
            analysisType: "count",
            groupBy: "browser.name"
        });
        
        //Create a PieChart visualization for that Metric.
        var browserPieChart = new Keen.PieChart(browserGrouped, {
            height: 300,
            width: 600,
            title: "Browsers",
            minimumSlicePercentage: 1,
            colors:["#FF6699","#33CCCC","#003366","#FFCC33","#009966"]
        });
        
        //Draw the visualization into a div
        browserPieChart.draw(document.getElementById("browserPie"));
        

    });
    
    
   </script>
   
 </head>
 <body>
  <h1>Analysis!</h1>

<p>How many events are in the hottie_selections collection?</p>
<div id="events"></div>
<p>How many unique users submitted hottie selections?</p>
<div id="uniqueNames"></div>
<p>Who was more popular: Slater or Zack?</p>
<div id="3"></div>
<p>What was the average rating for the course?</p>
<div id="4"></div>
<p>What browser was the most popular in the class?</p>
<div id="browserPie"></div>
<p>Did people who liked Slater rate the class higher or lower than people who like Zack?</p>
<!-- <div id="zackavg"></div><div id="slateravg"></div> -->

<table border="0" margin="10px">
<tr>
<td><div id="slateravg"></td>
<td><div id="zackavg"></div></td>
</tr>
</table>

  
 </body>
</html>